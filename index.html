<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buse'nin Zaman KapsÃ¼lÃ¼ â¤ï¸</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        :root { --primary: #ff8fa3; --bg: #fff0f3; --white: #ffffff; --text: #4a4a4a; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        .container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; transition: 0.3s; }
        .hidden { display: none !important; }
        
        /* GiriÅŸ EkranÄ± */
        #auth-container { display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .auth-box { background: var(--white); padding: 2rem; border-radius: 20px; width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(255, 107, 129, 0.2); }
        .auth-box h1 { color: #ff6b81; font-size: 1.5rem; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ffe3e3; border-radius: 12px; outline: none; text-align: center; }
        input:focus { border-color: var(--primary); }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* Uygulama Ä°Ã§i */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .capsule-list { padding: 20px; overflow-y: auto; height: calc(100vh - 70px); padding-bottom: 80px; }
        .capsule-card { background: var(--white); padding: 15px; margin-bottom: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); border: 1px solid #ffe3e3; }
        
        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: flex-end; justify-content: center; z-index: 99; }
        .modal-content { background: var(--white); width: 100%; max-width: 500px; border-radius: 25px 25px 0 0; padding: 25px; }
        textarea { width: 100%; height: 100px; padding: 10px; border: 2px solid #eee; border-radius: 10px; resize: none; margin-bottom: 10px; }
        
        @media (min-width: 768px) { .modal { align-items: center; } .modal-content { border-radius: 25px; width: 400px; } #app-container { max-width: 600px; margin: 0 auto; background: #fff; height: 100vh; position: relative; } }
    </style>
</head>
<body>

    <div id="auth-container" class="container">
        <div class="auth-box">
            <h1>HoÅŸ Geldin ğŸŒ¸</h1>
            <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">Bu kapsÃ¼l sana Ã¶zel.</p>
            
            <input type="text" id="username" placeholder="AdÄ±n ne?">
            <input type="password" id="password" placeholder="Åifren?">
            <button onclick="checkLogin()">GiriÅŸ Yap</button>
            <p id="error-msg" style="color:red; font-size:0.8rem; margin-top:10px;"></p>
        </div>
    </div>

    <div id="app-container" class="container hidden">
        <header>
            <div style="font-weight:bold; color:var(--primary);">Buse'nin AnÄ±larÄ±</div>
            <i class="fas fa-plus-circle" onclick="openModal()" style="font-size:1.8rem; color:var(--primary); cursor:pointer;"></i>
        </header>

        <div id="capsule-list" class="capsule-list">
            <div style="text-align:center; margin-top:50px; color:#ccc;">YÃ¼kleniyor...</div>
        </div>
        
        <div id="create-modal" class="modal hidden">
            <div class="modal-content">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <h3>Yeni AnÄ± Ekle</h3>
                    <span onclick="closeModal()" style="font-size:1.5rem;">&times;</span>
                </div>
                <textarea id="capsule-text" placeholder="BugÃ¼n neler oldu?"></textarea>
                
                <label style="font-size:0.8rem; color:#666;">Ne zaman aÃ§Ä±lsÄ±n?</label>
                <input type="datetime-local" id="capsule-date" style="text-align:left;">
                
                <button onclick="saveCapsule()" id="save-btn">Sakla ğŸ”’</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script>
        // --- API AYARLARI ---
        const firebaseConfig = {
          apiKey: "AIzaSyCD_dKXan4yjAzxqLC8Yfjx4JzXNne45Lk",
          authDomain: "zamankaps.firebaseapp.com",
          projectId: "zamankaps",
          storageBucket: "zamankaps.firebasestorage.app",
          messagingSenderId: "167594541047",
          appId: "1:167594541047:web:b61c2ba198c07c69c8b8f2",
          measurementId: "G-268PLLLDRD"
        };

        // Firebase BaÅŸlat
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (e) {
            console.error("Firebase baÅŸlatÄ±lamadÄ±, API keyleri kontrol et.");
        }
        
        const db = firebase.firestore();
        const FIXED_USER_ID = "buse_ozel_kullanici"; 

        // --- GÄ°RÄ°Å KONTROLÃœ ---
        function checkLogin() {
            const user = document.getElementById('username').value.trim().toLowerCase();
            const pass = document.getElementById('password').value.trim();
            const error = document.getElementById('error-msg');

            if (user === "buse" && pass === "buse2525") {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                loadCapsules();
            } else {
                error.innerText = "HatalÄ± bilgi girdin tatlÄ±m. Tekrar dene. ğŸ§";
                setTimeout(() => error.innerText = "", 3000);
            }
        }

        // --- VERÄ°TABANI Ä°ÅLEMLERÄ° ---
        
        function loadCapsules() {
            const list = document.getElementById('capsule-list');
            list.innerHTML = '<div style="text-align:center; margin-top:50px; color:#ccc;">AnÄ±lar getiriliyor...</div>';

            db.collection('capsules')
              .where("userId", "==", FIXED_USER_ID)
              .orderBy("openDate", "asc")
              .get()
              .then((snapshot) => {
                  list.innerHTML = "";
                  if (snapshot.empty) {
                      list.innerHTML = '<div style="text-align:center; margin-top:50px; color:#ccc;">HenÃ¼z hiÃ§ anÄ± yok. <br>SaÄŸ Ã¼stten + ile ekle! ğŸŒ¸</div>';
                      return;
                  }

                  snapshot.forEach(doc => {
                      const data = doc.data();
                      if(!data.openDate) return;
                      const date = data.openDate.toDate();
                      const now = new Date();
                      const isLocked = now < date;

                      if (isLocked) {
                          const diff = Math.ceil((date - now) / (1000 * 60 * 60 * 24));
                          list.innerHTML += `
                            <div class="capsule-card" style="background:#f9f9f9; opacity:0.8;">
                                <div style="display:flex; justify-content:space-between; color:#999; font-size:0.8rem; margin-bottom:10px;">
                                    <span>ğŸ”’ KÄ°LÄ°TLÄ°</span>
                                    <span>${date.toLocaleDateString()}</span>
                                </div>
                                <div style="text-align:center; padding:10px;">Bu sÃ¼rpriz ${diff} gÃ¼n sonra aÃ§Ä±lacak. ğŸ</div>
                            </div>`;
                      } else {
                          list.innerHTML += `
                            <div class="capsule-card">
                                <div style="display:flex; justify-content:space-between; color:var(--primary); font-size:0.8rem; margin-bottom:5px;">
                                    <span>âœ¨ ANI</span>
                                    <span>${date.toLocaleDateString()}</span>
                                </div>
                                <div style="color:#555; line-height:1.4;">${data.text}</div>
                            </div>`;
                      }
                  });
              })
              .catch(err => {
                  console.error(err);
                  list.innerHTML = '<div style="text-align:center; color:red;">Veriler Ã§ekilemedi.</div>';
              });
        }

        async function saveCapsule() {
            const text = document.getElementById('capsule-text').value;
            const dateVal = document.getElementById('capsule-date').value;
            const btn = document.getElementById('save-btn');

            if (!text) return alert("BoÅŸ anÄ± olmaz! Bir ÅŸeyler yaz.");
            if (!dateVal) return alert("Ne zaman aÃ§Ä±lacaÄŸÄ±nÄ± seÃ§melisin.");

            btn.innerText = "YÃ¼kleniyor...";
            btn.disabled = true;

            try {
                // Sadece veritabanÄ±na yazÄ±yoruz (FotoÄŸraf yok)
                await db.collection('capsules').add({
                    userId: FIXED_USER_ID,
                    text: text,
                    openDate: firebase.firestore.Timestamp.fromDate(new Date(dateVal)),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                closeModal();
                document.getElementById('capsule-text').value = "";
                loadCapsules();
                alert("AnÄ± baÅŸarÄ±yla saklandÄ±! ğŸ’–");

            } catch (error) {
                alert("Hata oluÅŸtu: " + error.message);
            } finally {
                btn.innerText = "Sakla ğŸ”’";
                btn.disabled = false;
            }
        }

        function openModal() {
            document.getElementById('create-modal').classList.remove('hidden');
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('capsule-date').min = now.toISOString().slice(0,16);
        }
        function closeModal() { document.getElementById('create-modal').classList.add('hidden'); }
    </script>
</body>
</html>
