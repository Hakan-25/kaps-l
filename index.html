<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buse'ye √ñzel ‚ù§Ô∏è</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');
        :root { --primary: #ff8fa3; --bg: #fff0f3; --white: #ffffff; --text: #4a4a4a; }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg); color: var(--text); height: 100vh; overflow: hidden; }
        .container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; transition: 0.3s; }
        .hidden { display: none !important; }
        
        /* Giri≈ü Ekranƒ± */
        #auth-container { display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .auth-box { background: var(--white); padding: 2rem; border-radius: 20px; width: 85%; max-width: 320px; text-align: center; box-shadow: 0 10px 30px rgba(255, 107, 129, 0.2); }
        .auth-box h1 { color: #ff6b81; font-size: 1.5rem; margin-bottom: 5px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #ffe3e3; border-radius: 12px; outline: none; text-align: center; }
        input:focus { border-color: var(--primary); }
        button { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        
        /* Uygulama ƒ∞√ßi */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--white); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .capsule-list { padding: 20px; overflow-y: auto; height: calc(100vh - 70px); padding-bottom: 80px; }
        .capsule-card { background: var(--white); padding: 15px; margin-bottom: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.03); border: 1px solid #ffe3e3; }
        .capsule-img { width: 100%; border-radius: 10px; margin-top: 10px; }
        .locked-badge { background: #eee; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; color: #777; display: inline-block; }
        
        /* Modal */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; align-items: flex-end; justify-content: center; z-index: 99; }
        .modal-content { background: var(--white); width: 100%; max-width: 500px; border-radius: 25px 25px 0 0; padding: 25px; }
        textarea { width: 100%; height: 100px; padding: 10px; border: 2px solid #eee; border-radius: 10px; resize: none; margin-bottom: 10px; }
        
        @media (min-width: 768px) { .modal { align-items: center; } .modal-content { border-radius: 25px; width: 400px; } #app-container { max-width: 600px; margin: 0 auto; background: #fff; height: 100vh; position: relative; } }
    </style>
</head>
<body>

    <div id="auth-container" class="container">
        <div class="auth-box">
            <h1>Ho≈ü Geldin üå∏</h1>
            <p style="color:#aaa; font-size:0.9rem; margin-bottom:15px;">Bu kaps√ºl sana √∂zel.</p>
            
            <input type="text" id="username" placeholder="Adƒ±n ne?">
            <input type="password" id="password" placeholder="≈ûifren?">
            <button onclick="checkLogin()">Giri≈ü Yap</button>
            <p id="error-msg" style="color:red; font-size:0.8rem; margin-top:10px;"></p>
        </div>
    </div>

    <div id="app-container" class="container hidden">
        <header>
            <div style="font-weight:bold; color:var(--primary);">Buse'nin Anƒ±larƒ±</div>
            <i class="fas fa-plus-circle" onclick="openModal()" style="font-size:1.8rem; color:var(--primary); cursor:pointer;"></i>
        </header>

        <div id="capsule-list" class="capsule-list">
            <div style="text-align:center; margin-top:50px; color:#ccc;">Y√ºkleniyor...</div>
        </div>
        
        <div id="create-modal" class="modal hidden">
            <div class="modal-content">
                <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                    <h3>Yeni Anƒ± Ekle</h3>
                    <span onclick="closeModal()" style="font-size:1.5rem;">&times;</span>
                </div>
                <textarea id="capsule-text" placeholder="Bug√ºn neler oldu?"></textarea>
                <input type="file" id="capsule-image" accept="image/*" style="border:none; text-align:left; padding-left:0;">
                <label style="font-size:0.8rem; color:#666;">Ne zaman a√ßƒ±lsƒ±n?</label>
                <input type="datetime-local" id="capsule-date" style="text-align:left;">
                <button onclick="saveCapsule()" id="save-btn">Sakla üîí</button>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

    <script>
        // --- 1. AYARLAR ---
        const firebaseConfig = {
            apiKey: "BURAYA_API_KEY_YAPISTIR",
            authDomain: "BURAYA_AUTH_DOMAIN_YAPISTIR",
            projectId: "BURAYA_PROJECT_ID_YAPISTIR",
            storageBucket: "BURAYA_STORAGE_BUCKET_YAPISTIR",
            messagingSenderId: "BURAYA_SENDER_ID",
            appId: "BURAYA_APP_ID"
        };

        // Firebase Ba≈ülat
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Sabit Kullanƒ±cƒ± ID (Authentication olmadƒ±ƒüƒ± i√ßin bunu uyduruyoruz)
        const FIXED_USER_ID = "buse_ozel_kullanici"; 

        // --- 2. Gƒ∞Rƒ∞≈û KONTROL√ú (Kodun ƒ∞√ßinde) ---
        function checkLogin() {
            const user = document.getElementById('username').value.trim().toLowerCase();
            const pass = document.getElementById('password').value.trim();
            const error = document.getElementById('error-msg');

            // ≈ûƒ∞FRE BURADA KONTROL EDƒ∞Lƒ∞YOR
            if (user === "buse" && pass === "buse2525") {
                document.getElementById('auth-container').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                loadCapsules(); // Giri≈ü ba≈üarƒ±lƒ±ysa verileri √ßek
            } else {
                error.innerText = "Hatalƒ± bilgi girdin tatlƒ±m. Tekrar dene. üßê";
                setTimeout(() => error.innerText = "", 3000);
            }
        }

        // --- 3. VERƒ∞TABANI ƒ∞≈ûLEMLERƒ∞ ---
        
        // Kaps√ºlleri Listele
        function loadCapsules() {
            const list = document.getElementById('capsule-list');
            list.innerHTML = '<div style="text-align:center; margin-top:50px; color:#ccc;">Anƒ±lar getiriliyor...</div>';

            db.collection('capsules')
              .where("userId", "==", FIXED_USER_ID) // Sadece Buse'nin verileri
              .orderBy("openDate", "asc")
              .get()
              .then((snapshot) => {
                  list.innerHTML = "";
                  if (snapshot.empty) {
                      list.innerHTML = '<div style="text-align:center; margin-top:50px; color:#ccc;">Hen√ºz hi√ß anƒ± yok. <br>Saƒü √ºstten + ile ekle! üå∏</div>';
                      return;
                  }

                  snapshot.forEach(doc => {
                      const data = doc.data();
                      const date = data.openDate.toDate();
                      const now = new Date();
                      const isLocked = now < date;

                      if (isLocked) {
                          // Kƒ∞Lƒ∞TLƒ∞
                          const diff = Math.ceil((date - now) / (1000 * 60 * 60 * 24));
                          list.innerHTML += `
                            <div class="capsule-card" style="background:#f9f9f9; opacity:0.8;">
                                <div style="display:flex; justify-content:space-between; color:#999; font-size:0.8rem; margin-bottom:10px;">
                                    <span>üîí Kƒ∞Lƒ∞TLƒ∞</span>
                                    <span>${date.toLocaleDateString()}</span>
                                </div>
                                <div style="text-align:center; padding:10px;">
                                    Bu s√ºrpriz ${diff} g√ºn sonra a√ßƒ±lacak. üéÅ
                                </div>
                            </div>`;
                      } else {
                          // A√áIK
                          list.innerHTML += `
                            <div class="capsule-card">
                                <div style="display:flex; justify-content:space-between; color:var(--primary); font-size:0.8rem; margin-bottom:5px;">
                                    <span>‚ú® ANI</span>
                                    <span>${date.toLocaleDateString()}</span>
                                </div>
                                <div style="color:#555; line-height:1.4;">${data.text}</div>
                                ${data.imageUrl ? `<img src="${data.imageUrl}" class="capsule-img" onclick="window.open(this.src)">` : ''}
                            </div>`;
                      }
                  });
              })
              .catch(err => {
                  console.error(err);
                  list.innerHTML = '<div style="text-align:center; color:red;">Veriler √ßekilemedi. ƒ∞nternetini kontrol et.</div>';
              });
        }

        // Kaps√ºl Kaydet
        async function saveCapsule() {
            const text = document.getElementById('capsule-text').value;
            const dateVal = document.getElementById('capsule-date').value;
            const file = document.getElementById('capsule-image').files[0];
            const btn = document.getElementById('save-btn');

            if (!text && !file) return alert("Bo≈ü anƒ± olmaz! Yazƒ± veya resim ekle.");
            if (!dateVal) return alert("Ne zaman a√ßƒ±lacaƒüƒ±nƒ± se√ßmelisin.");

            btn.innerText = "Y√ºkleniyor...";
            btn.disabled = true;

            try {
                let imageUrl = null;
                
                // Resim varsa y√ºkle
                if (file) {
                    const ref = storage.ref('capsules/' + Date.now() + '_' + file.name);
                    await ref.put(file);
                    imageUrl = await ref.getDownloadURL();
                }

                // Veritabanƒ±na yaz
                await db.collection('capsules').add({
                    userId: FIXED_USER_ID, // Sabit ID kullanƒ±yoruz
                    text: text,
                    imageUrl: imageUrl,
                    openDate: firebase.firestore.Timestamp.fromDate(new Date(dateVal)),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                closeModal();
                document.getElementById('capsule-text').value = "";
                document.getElementById('capsule-image').value = "";
                loadCapsules(); // Listeyi yenile
                alert("Anƒ± ba≈üarƒ±yla saklandƒ±! üíñ");

            } catch (error) {
                alert("Hata olu≈ütu: " + error.message);
            } finally {
                btn.innerText = "Sakla üîí";
                btn.disabled = false;
            }
        }

        // Modal A√ß/Kapa
        function openModal() {
            document.getElementById('create-modal').classList.remove('hidden');
            // Tarihi bug√ºne ayarla
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('capsule-date').min = now.toISOString().slice(0,16);
        }
        function closeModal() { document.getElementById('create-modal').classList.add('hidden'); }
    </script>
</body>
</html>
